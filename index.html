<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="./manifest.json?v=3">
<meta name="theme-color" content="#0077ff">

<title>ê·¼ë¬´ ì‹œê°„ ìº˜ë¦°ë”</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 10px;
  background: #f5f6f8;
}

h1 {
  text-align: center;
  margin-bottom: 10px;
}

.header {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  margin-bottom: 10px;
}

/* ìš”ì¼ */
.weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  text-align: center;
  font-weight: bold;
  margin-bottom: 5px;
}

.sun { color: red; }
.sat { color: blue; }

#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
}

.day {
  background: white;
  border-radius: 6px;
  padding: 6px;
  min-height: 95px;
  cursor: pointer;
  font-size: 14px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.day strong {
  display: block;
  margin-bottom: 4px;
}

.sun-day strong { color: red; }
.sat-day strong { color: blue; }

/* ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ */
.today strong {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: 2px solid #ff0000;
  box-sizing: border-box;
}
/* ì‹œê°„ */
.work-time {
  font-size: 12px;
  color: #0077ff;
}

.work-duration {
  font-size: 12px;
  color: #0077ff;
  margin-top: 4px;
}

/* í•˜ë‹¨ ì¹´ë“œ */
.total {
  margin-top: 20px;
  background: white;
  padding: 15px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.total h3 {
  margin: 0 0 6px;
  color: #555;
}

.total span {
  font-size: 22px;
  font-weight: bold;
  color: #0077ff;
}

/* ëª¨ë‹¬ */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
}

.modal-content {
  background: white;
  padding: 20px;
  width: 90%;
  max-width: 300px;
  margin: 120px auto;
  border-radius: 10px;
}

.modal-content input {
  width: 100%;
  margin: 5px 0 10px;
}

.modal-content button {
  width: 100%;
  margin-top: 6px;
}

.delete-btn {
  background: #ff4d4d;
  color: white;
  border: none;
}

/* ëª¨ë°”ì¼ */
@media (max-width: 600px) {
  .pc { display: none; }
}
@media (min-width: 601px) {
  .mobile { display: none; }
}
</style>
</head>

<body>

<h1>ê·¼ë¬´ ì‹œê°„ ìº˜ë¦°ë”</h1>

<div class="header">
  <button id="prev">â—€</button>
  <h2 id="month"></h2>
  <button id="next">â–¶</button>
</div>

<div class="weekdays">
  <div class="sun">ì¼</div>
  <div>ì›”</div>
  <div>í™”</div>
  <div>ìˆ˜</div>
  <div>ëª©</div>
  <div>ê¸ˆ</div>
  <div class="sat">í† </div>
</div>

<div id="calendar"></div>

<div class="total">
  <h3>ì „ì›” 25ì¼ ~ ë‹¹ì›” 25ì¼ ì´ ê·¼ë¬´ì‹œê°„</h3>
  <span id="totalTime">0ì‹œê°„ 0ë¶„</span>
</div>

<!-- ëª¨ë‹¬ -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modalDate"></h3>
    ì‹œì‘ ì‹œê°„
    <input type="time" id="startTime">
    ì¢…ë£Œ ì‹œê°„
    <input type="time" id="endTime">
    <button id="save">ì €ì¥</button>
    <button class="delete-btn" id="delete">í•˜ë£¨ ê·¼ë¬´ ì‚­ì œ</button>
    <button onclick="closeModal()">ë‹«ê¸°</button>
  </div>
</div>

<script>
let current = new Date();
let selectedDate = "";
const workData = JSON.parse(localStorage.getItem("workData")) || {};

const calendar = document.getElementById("calendar");
const month = document.getElementById("month");
const modal = document.getElementById("modal");
const modalDate = document.getElementById("modalDate");
const startTime = document.getElementById("startTime");
const endTime = document.getElementById("endTime");
const saveBtn = document.getElementById("save");
const deleteBtn = document.getElementById("delete");
const totalTime = document.getElementById("totalTime");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");

function saveData() {
  localStorage.setItem("workData", JSON.stringify(workData));
}

function calcDuration(start, end) {
  const [sh, sm] = start.split(":").map(Number);
  const [eh, em] = end.split(":").map(Number);
  let min = (eh*60+em) - (sh*60+sm);
  if (min < 0) min += 24*60;
  return { min };
}

function renderCalendar() {
  calendar.innerHTML = "";
  const y = current.getFullYear();
  const m = current.getMonth();

  month.textContent = `${y}ë…„ ${m+1}ì›”`;

  const today = new Date();
  const ty = today.getFullYear();
  const tm = today.getMonth();
  const td = today.getDate();

  const firstDay = new Date(y, m, 1).getDay();
  const lastDate = new Date(y, m+1, 0).getDate();

  for (let i=0;i<firstDay;i++) {
    calendar.appendChild(document.createElement("div"));
  }

  for (let d=1; d<=lastDate; d++) {
    const date = new Date(y, m, d);
    const dow = date.getDay();
    const dateStr = `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;

    const div = document.createElement("div");
    div.className = "day";

    if (dow===0) div.classList.add("sun-day");
    if (dow===6) div.classList.add("sat-day");
    if (y===ty && m===tm && d===td) div.classList.add("today");

    div.innerHTML = `<strong>${d}</strong>`;

    if (workData[dateStr]) {
      const w = workData[dateStr];
      const durMin = calcDuration(w.start, w.end).min;
      div.innerHTML += `
        <div class="work-time pc">${w.start} ~ ${w.end}</div>
        <div class="work-time mobile">${w.start}<br>${w.end}</div>
        <div class="work-duration pc">${Math.floor(durMin/60)}ì‹œê°„ ${durMin%60}ë¶„</div>
        <div class="work-duration mobile">${Math.floor(durMin/60)}ì‹œê°„<br>${durMin%60}ë¶„</div>
      `;
    }

    div.onclick = () => openModal(dateStr);
    calendar.appendChild(div);
  }

  calcTotal();
}

function openModal(date) {
  selectedDate = date;
  modalDate.textContent = date;
  startTime.value = workData[date]?.start || "";
  endTime.value = workData[date]?.end || "";
  modal.style.display = "block";
}

function closeModal() {
  modal.style.display = "none";
}

saveBtn.onclick = () => {
  if (startTime.value && endTime.value) {
    workData[selectedDate] = { start: startTime.value, end: endTime.value };
    saveData();
    closeModal();
    renderCalendar();
  }
};

deleteBtn.onclick = () => {
  if (workData[selectedDate]) {
    delete workData[selectedDate];
    saveData();
    closeModal();
    renderCalendar();
  }
};

/* ğŸ”¥ ì´í•©ê³„ ê³„ì‚°: ì „ì›” 25ì¼ ~ ì´ë²ˆë‹¬ 25ì¼ */
function calcTotal() {
  let totalMin = 0;

  const y = current.getFullYear();
  const m = current.getMonth();

  const start = new Date(y, m-1, 26);
  const end = new Date(y, m, 26);

  for (const date in workData) {
    const d = new Date(date);
    if (d >= start && d < end) {
      totalMin += calcDuration(workData[date].start, workData[date].end).min;
    }
  }

  totalTime.textContent =
    `${Math.floor(totalMin/60)}ì‹œê°„ ${totalMin%60}ë¶„`;
}

prevBtn.onclick = () => {
  current.setMonth(current.getMonth()-1);
  renderCalendar();
};

nextBtn.onclick = () => {
  current.setMonth(current.getMonth()+1);
  renderCalendar();
};

renderCalendar();
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js");
}
</script>

</body>
</html>
